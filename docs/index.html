<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8">
  <title>台股三大法人持股追蹤（上市＋上櫃）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="追蹤三大法人（外資、投信、自營商）持股比例變化及券商分點主力進出">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- 頂部導航 -->
  <header class="header">
    <div class="header-content">
      <h1>📊 台股法人籌碼追蹤</h1>
      <p class="header-subtitle">整合三大法人持股 + 券商分點主力進出</p>
    </div>
    <nav class="main-nav">
      <button class="nav-btn active" data-section="institutional">三大法人</button>
      <button class="nav-btn" data-section="broker">券商分點</button>
      <button class="nav-btn" data-section="ai-analysis">AI智能分析</button>
    </nav>
  </header>

  <!-- 三大法人區塊 -->
  <section id="institutional" class="section active">
    <div class="card">
      <h2>🏛️ 三大法人持股比例追蹤</h2>
      <p class="subtitle">
        資料來源：TWSE / TPEX 官方盤後資料。投信與自營商持股為模型估計值，僅供研究使用。
      </p>
      <div class="controls">
        <div class="control-block">
          <label for="stockInput">股票代碼：</label>
          <input id="stockInput" type="text" placeholder="2330">
          <button id="loadBtn">載入</button>
          <span id="statusText" class="subtitle"></span>
        </div>
        <div class="control-block">
          <label for="marketFilter">市場：</label>
          <select id="marketFilter">
            <option value="ALL">全部</option>
            <option value="TWSE">上市 (TWSE)</option>
            <option value="TPEX">上櫃 (TPEX)</option>
          </select>
        </div>
        <div class="control-block">
          <label for="windowFilter">視窗：</label>
          <select id="windowFilter">
            <option value="5">5 日</option>
            <option value="20" selected>20 日</option>
            <option value="60">60 日</option>
            <option value="120">120 日</option>
          </select>
        </div>
        <div class="control-block">
          <label><input type="checkbox" id="logScaleCheckbox"> Log scale</label>
        </div>
      </div>
      <div class="control-block small checkbox-group">
        <span>顯示：</span>
        <label><input type="checkbox" id="showForeign" checked> 外資</label>
        <label><input type="checkbox" id="showTrust" checked> 投信</label>
        <label><input type="checkbox" id="showDealer" checked> 自營商</label>
        <label><input type="checkbox" id="showTotal" checked> 合計</label>
      </div>
    </div>

    <div class="row">
      <div class="col chart-col">
        <div class="card">
          <h3 id="chartTitle">2330 三大法人持股比重</h3>
          <div class="chart-wrapper">
            <canvas id="ratioChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col table-col">
        <div class="card">
          <h3>📈 三大法人持股變化排名</h3>
          <p class="subtitle">
            按選定視窗之三大法人合計持股比重變化排序
          </p>
          <div class="table-container">
            <table id="rankTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>股票</th>
                  <th>市場</th>
                  <th>持股%</th>
                  <th>ΔChange</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 券商分點區塊 -->
  <section id="broker" class="section">
    <div class="card">
      <h2>🏦 券商分點主力進出追蹤</h2>
      <p class="subtitle">
        追蹤外資券商（高盛、摩根、美林）及國內主力（凱基、元大、富邦）的買賣超情況
      </p>
      <div id="brokerSummaryStats" class="broker-stats-grid">
        <div class="stat-card">
          <div class="stat-icon">📊</div>
          <div class="stat-info">
            <div class="stat-value" id="totalBrokers">載入中...</div>
            <div class="stat-label">活躍券商</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">📈</div>
          <div class="stat-info">
            <div class="stat-value net-negative" id="totalBuyVolume">載入中...</div>
            <div class="stat-label">總買超(張)</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">📉</div>
          <div class="stat-info">
            <div class="stat-value net-positive" id="totalSellVolume">載入中...</div>
            <div class="stat-label">總賣超(張)</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">🎯</div>
          <div class="stat-info">
            <div class="stat-value" id="targetStocks">載入中...</div>
            <div class="stat-label">追蹤股票</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 券商活躍度視覺化 -->
    <div class="row broker-row">
      <div class="col">
        <div class="card">
          <h3>🏆 券商買賣超排行榜</h3>
          <div class="broker-chart-wrapper">
            <canvas id="brokerRankingChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <h3>📈 券商累計趨勢圖</h3>
          <div class="control-block">
            <label for="brokerSelect">選擇券商：</label>
            <select id="brokerSelect">
              <option value="ALL">全部目標券商</option>
            </select>
          </div>
          <div class="broker-chart-wrapper">
            <canvas id="brokerTrendChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- 券商交易熱力圖 -->
    <div class="card">
      <h3>🔥 券商交易活躍度熱力圖</h3>
      <div id="brokerHeatmap" class="broker-heatmap-container">
        載入中...
      </div>
    </div>

    <!-- 目標券商追蹤卡片 -->
    <div class="card">
      <h3>🎯 重點券商即時監控</h3>
      <div id="targetBrokersContent" class="target-brokers-dashboard">
        載入中...
      </div>
    </div>

    <!-- 詳細交易資料 -->
    <div class="card">
      <div class="card-header">
        <h3>📋 今日交易明細</h3>
        <div class="trade-filters">
          <select id="stockFilter">
            <option value="ALL">全部股票</option>
          </select>
          <select id="brokerFilter">
            <option value="ALL">全部券商</option>
          </select>
          <select id="actionFilter">
            <option value="ALL">全部操作</option>
            <option value="BUY">僅買超</option>
            <option value="SELL">僅賣超</option>
          </select>
        </div>
      </div>
      <div id="brokerTradesStatus" class="trades-summary">載入中...</div>
      <div class="table-container large">
        <div class="table-wrapper">
          <table id="brokerTradesTable">
            <thead>
              <tr>
                <th>#</th>
                <th>股票</th>
                <th>券商分點</th>
                <th>買進(張)</th>
                <th>賣出(張)</th>
                <th>買賣超</th>
                <th>佔比%</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- AI 智能分析區塊 -->
  <section id="ai-analysis" class="section">
    <div class="card">
      <h2>🤖 AI 智能分析</h2>
      <p class="subtitle">
        運用 GPT-4 模型深度分析法人持股趨勢、券商行為模式、市場情緒與個股推薦
      </p>
    </div>

    <!-- 分析報告摘要 -->
    <div class="row ai-row">
      <div class="col">
        <div class="card">
          <h3>📊 法人持股趨勢圖</h3>
          <div class="ai-chart-wrapper">
            <canvas id="institutionalTrendChart"></canvas>
          </div>
          <div id="trendAnalysisContent" class="analysis-content">
            載入中...
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <h3>💭 市場情緒儀表板</h3>
          <div class="ai-chart-wrapper sentiment-chart">
            <canvas id="sentimentGauge"></canvas>
          </div>
          <div id="sentimentAnalysisContent" class="analysis-content">
            載入中...
          </div>
        </div>
      </div>
    </div>

    <div class="row ai-row">
      <div class="col">
        <div class="card">
          <h3>⭐ 推薦股票評分雷達圖</h3>
          <div class="ai-chart-wrapper radar-chart">
            <canvas id="recommendationRadarChart"></canvas>
          </div>
          <div id="recommendationsContent" class="analysis-content">
            載入中...
          </div>
        </div>
      </div>
      <div class="col">
        <div class="card">
          <h3>🎯 持股變化熱力圖</h3>
          <div id="holdingHeatmap" class="heatmap-container">
            載入中...
          </div>
        </div>
      </div>
    </div>

    <!-- 個股深度分析 -->
    <div class="card">
      <h3>🔍 個股深度分析</h3>
      <div id="individualAnalysisContent" class="broker-grid">
        載入中...
      </div>
    </div>

    <!-- 分析報告詳情 -->
    <div class="card">
      <h3>📋 完整分析報告</h3>
      <div class="controls">
        <div class="control-block">
          <label for="reportSelect">選擇報告：</label>
          <select id="reportSelect">
            <option value="">請選擇報告...</option>
            <option value="trend_analysis_5d">5日趨勢分析</option>
            <option value="trend_analysis_20d">20日趨勢分析</option>
            <option value="trend_analysis_60d">60日趨勢分析</option>
            <option value="market_sentiment_analysis">市場情緒分析</option>
            <option value="stock_recommendations">股票推薦</option>
          </select>
        </div>
      </div>
      <div id="fullReportContent" class="analysis-report">
        請選擇一個報告查看詳細內容
      </div>
    </div>
  </section>

  <footer class="footer">
    <p>資料每日自動更新</p>
    <p>Powered by <a href="https://www.zh-aoi.com/" target="_blank" rel="noopener noreferrer">智合科技</a></p>
  </footer>

  <script src="script.js"></script>
</body>

</html>